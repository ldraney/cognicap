<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CogniCap - Cognitive Capacity Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .metric-card h3 {
            margin-bottom: 15px;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .status-healthy { background: rgba(76, 175, 80, 0.3); }
        .status-warning { background: rgba(255, 193, 7, 0.3); }
        .status-critical { background: rgba(244, 67, 54, 0.3); }
        
        .agents-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .agent-card {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .agent-card:hover {
            transform: translateY(-2px);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .agent-name {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .agent-metrics {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s;
        }
        
        .progress-fill.warning {
            background: linear-gradient(90deg, #ff9800, #ffc107);
        }
        
        .progress-fill.critical {
            background: linear-gradient(90deg, #f44336, #ff5722);
        }
        
        .experiment-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .alert-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        #chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            height: 400px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ§  CogniCap</h1>
            <p class="subtitle">Cognitive Capacity & Semantic Drift Measurement</p>
        </header>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>Total Measurements</h3>
                <div class="metric-value" id="total-measurements">0</div>
                <div class="metric-status status-healthy">Collecting Data</div>
            </div>
            
            <div class="metric-card">
                <h3>Active Agents</h3>
                <div class="metric-value" id="active-agents">0</div>
                <div class="metric-status status-healthy">Monitoring</div>
            </div>
            
            <div class="metric-card">
                <h3>Active Alerts</h3>
                <div class="metric-value" id="active-alerts">0</div>
                <div class="metric-status" id="alert-status">No Issues</div>
            </div>
            
            <div class="metric-card">
                <h3>Experiments Run</h3>
                <div class="metric-value" id="experiments">0</div>
                <div class="metric-status status-healthy">Ready</div>
            </div>
        </div>
        
        <div class="agents-section">
            <h2>Agent Performance</h2>
            <div class="agents-grid" id="agents-grid">
                <!-- Agent cards will be inserted here -->
            </div>
        </div>
        
        <div class="experiment-section">
            <h2>Experiment Runner</h2>
            <p style="margin: 15px 0; opacity: 0.9;">Test different agent configurations to find optimal settings</p>
            <button class="button" onclick="runExperiment()">Run New Experiment</button>
            <button class="button" onclick="compareConfigs()">Compare Configurations</button>
            <div id="experiment-results" style="margin-top: 20px;"></div>
        </div>
        
        <div id="chart-container">
            <canvas id="drift-chart"></canvas>
        </div>
    </div>
    
    <script>
        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                document.getElementById('total-measurements').textContent = data.totalMeasurements;
                document.getElementById('active-agents').textContent = data.agents.length;
                document.getElementById('active-alerts').textContent = data.activeAlerts;
                document.getElementById('experiments').textContent = data.experiments;
                
                const alertStatus = document.getElementById('alert-status');
                if (data.activeAlerts > 0) {
                    alertStatus.textContent = `${data.activeAlerts} Active`;
                    alertStatus.className = 'metric-status status-warning';
                } else {
                    alertStatus.textContent = 'No Issues';
                    alertStatus.className = 'metric-status status-healthy';
                }
                
                const agentsGrid = document.getElementById('agents-grid');
                agentsGrid.innerHTML = '';
                
                data.agents.forEach(agent => {
                    const card = document.createElement('div');
                    card.className = 'agent-card';
                    card.onclick = () => viewAgentDetails(agent.agentId);
                    
                    const consistency = (agent.semanticConsistency * 100).toFixed(1);
                    const load = (agent.cognitiveLoad * 100).toFixed(1);
                    
                    let loadClass = '';
                    if (agent.cognitiveLoad > 0.75) loadClass = 'critical';
                    else if (agent.cognitiveLoad > 0.50) loadClass = 'warning';
                    
                    card.innerHTML = `
                        <div class="agent-name">${agent.agentId}</div>
                        <div style="font-size: 0.9em; opacity: 0.8;">Status: ${agent.status}</div>
                        
                        <div style="margin-top: 15px;">
                            <div style="font-size: 0.85em; opacity: 0.9;">Semantic Consistency</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${consistency}%"></div>
                            </div>
                            <div style="font-size: 0.8em; text-align: right;">${consistency}%</div>
                        </div>
                        
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.85em; opacity: 0.9;">Cognitive Load</div>
                            <div class="progress-bar">
                                <div class="progress-fill ${loadClass}" style="width: ${load}%"></div>
                            </div>
                            <div style="font-size: 0.8em; text-align: right;">${load}%</div>
                        </div>
                    `;
                    
                    agentsGrid.appendChild(card);
                });
                
            } catch (error) {
                console.error('Failed to load dashboard:', error);
            }
        }
        
        async function viewAgentDetails(agentId) {
            window.location.href = `/agent.html?id=${agentId}`;
        }
        
        async function runExperiment() {
            const config = {
                id: 'exp-' + Date.now(),
                name: 'Test Configuration',
                database: Math.random() > 0.5,
                specialization: ['expert', 'generalist', 'hybrid'][Math.floor(Math.random() * 3)],
                contextWindow: ['minimal', 'standard', 'extended'][Math.floor(Math.random() * 3)],
                memoryStrategy: ['ephemeral', 'persistent', 'hybrid'][Math.floor(Math.random() * 3)]
            };
            
            const samples = [
                'The agent should maintain consistency in terminology',
                'Semantic drift occurs when terms change meaning over time',
                'Cognitive overload happens when processing exceeds capacity',
                'Database backing can improve semantic consistency',
                'Expert agents show better performance in specialized tasks'
            ];
            
            try {
                const response = await fetch('/api/experiment/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ configuration: config, samples, duration: 5000 })
                });
                
                const result = await response.json();
                
                document.getElementById('experiment-results').innerHTML = `
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 20px;">
                        <h3>Experiment Results</h3>
                        <p>Configuration: ${config.name}</p>
                        <p>Semantic Consistency: ${(result.metrics.semanticConsistency * 100).toFixed(1)}%</p>
                        <p>Cognitive Load: ${(result.metrics.cognitiveLoad * 100).toFixed(1)}%</p>
                        <p>Recommendations:</p>
                        <ul>${result.recommendations.map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                `;
            } catch (error) {
                console.error('Experiment failed:', error);
            }
        }
        
        async function compareConfigs() {
            alert('Compare configurations feature coming soon!');
        }
        
        loadDashboard();
        setInterval(loadDashboard, 5000);
    </script>
</body>
</html>